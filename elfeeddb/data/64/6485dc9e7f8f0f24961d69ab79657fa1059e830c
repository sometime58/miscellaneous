<p>Earlier this month I experienced a life-changing event — or so I
thought it would be. It was fully anticipated, and I had been dreading
the day for almost a year, wondering what I was going to do. Could I
overcome these dire straits? Would I ever truly accept the loss, or
will I become a cranky old man who won’t stop talking about how great
it all used to be?</p>

<p>So what was this <a href="https://utcc.utoronto.ca/~cks/space/blog/web/Firefox57ComingExplosion">big event</a>? On September 5th, Mozilla
officially and fully ended support for XUL extensions (<a href="https://en.wikipedia.org/wiki/XUL">XML User
Interface Language</a>), a.k.a. “legacy” extensions. The last
Firefox release to support these extensions was Firefox 52 ESR, the
browser I had been using for some time. A couple days later, Firefox
60 ESR entered Debian Stretch to replace it.</p>

<p>The XUL extension API was never well designed. It was clunky, quirky,
and the development process for extensions was painful, <a href="http://steve-yegge.blogspot.com/2007/01/pinocchio-problem.html">requiring
frequently restarts</a>. It was bad enough that I was never
interested in writing my own extensions. Poorly-written extensions
unfairly gave Firefox a bad name, causing <a href="https://utcc.utoronto.ca/~cks/space/blog/web/FirefoxResignedToLeaks">memory leaks</a> and other
issues, and Firefox couldn’t tame the misbehavior.</p>

<p>Yet this extension API was <em>incredibly powerful</em>, allowing for rather
extreme UI transformations that really did turn Firefox into a whole
new browser. For the past 15 years I wasn’t using Firefox so much as a
highly customized browser <em>based on</em> Firefox. It’s how Firefox has
really stood apart from everyone else, including Chrome.</p>

<p>The wide open XUL extension API was getting in the way of Firefox
moving forward. Continuing to support it required sacrifices that
Mozilla was less and less willing to make. To replace it, they
introduced the WebExtensions API, modeled very closely after Chrome’s
extension API. These extensions are sandboxed, much less trusted, and
the ecosystem more closely resembles the “app store” model (Ugh!).
This is great for taming poorly-behaved extensions, but they are <em>far</em>
less powerful and capable.</p>

<p>The powerful, transformative extension I’d <a href="/blog/2009/04/03/">been using the past
decade</a> was Vimperator — and occasionally with temporary stints in
its fork, Pentadactyl. It overhauled most of Firefox’s interface,
turning it into a Vim-like modal interface. In normal mode I had single
keys bound to all sorts of useful functionality.</p>

<p>The problem is that Vimperator is an XUL extension, and it’s not
possible to fully implement using the WebExtensions API. It needs
capabilities that WebExtensions will likely never provide. Losing XUL
extensions would mean being thrown back 10 years in terms my UI
experience. The possibility of having to use the web without it
sounded unpleasant.</p>

<p>Fortunately there was a savior on the horizon already waiting for me:
<a href="https://github.com/tridactyl/tridactyl"><strong>Tridactyl</strong></a>! It is essentially a from-scratch rewrite
of Vimperator using the WebExtensions API. To my complete surprise,
these folks have managed to recreate around 85% of what I had within
the WebExtensions limitations. It will never be 100%, but it’s close
enough to keep me happy.</p>

<h3 id="what-matters-to-me">What matters to me</h3>

<p>There are some key things Vimperator gave me that I was afraid of
losing.</p>

<ul>
  <li>Browser configuration from a text file.</li>
</ul>

<p>I keep all <a href="/blog/2012/06/23/">my personal configuration dotfiles under source
control</a>. It’s a shame that Firefox, despite being so
flexible, has never supported this approach to configuration.
Fortunately Vimperator filled this gap with its <code class="highlighter-rouge">.vimperatorrc</code> file,
which could not only be used to configure the extension but also access
nearly everything on the <code class="highlighter-rouge">about:config</code> page. It’s the killer feature
Firefox never had.</p>

<p>Since WebExtensions are sandboxed, they cannot (normally) access files.
Fortunately there’s a work around: <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Native_messaging"><strong>native messaging</strong></a>. It’s a
tiny, unsung backdoor that closes the loop on some vital features.
Tridactyl makes it super easy to set up (<code class="highlighter-rouge">:installnative</code>), and doing so
enables the <code class="highlighter-rouge">.tridactylrc</code> file to be loaded on startup. Due to
WebExtensions limitations it’s not nearly as powerful as the old
<code class="highlighter-rouge">.vimperatorrc</code> but it covers most of my needs.</p>

<ul>
  <li>Edit any text input using a real text editor.</li>
</ul>

<p>In Vimperator, when a text input is focused I could press CTRL+i to
pop up my <code class="highlighter-rouge">$EDITOR</code> (Vim, Emacs, etc.) to manipulate the input much
more comfortably. This is <em>so</em>, so nice when writing long form content
on the web. The alternative is to copy-paste back and forth, which is
tedious and error prone.</p>

<p>Since WebExtensions are sandboxed, they cannot (normally) start
processes. Again, native messaging comes to the rescue and allows
Tridactyl to reproduce this feature perfectly.</p>

<ul>
  <li>Mouseless browsing.</li>
</ul>

<p>In Vimperator I could press <code class="highlighter-rouge">f</code> or <code class="highlighter-rouge">F</code> to enter a special mode that
allowed me to simulate a click to a page element, usually a hyperlink.
This could be used to navigate without touching the mouse. It’s really
nice for “productive” browsing, where my fingers are already on home
row due to typing (programming or writing), and I need to switch to a
browser to look something up. I rarely touch the mouse when I’m in
productive mode.</p>

<p>This actually mostly works fine under WebExtensions, too. However, due
to sandboxing, WebExtensions aren’t active on any of Firefox’s “meta”
pages (configuration, errors, etc.), or Mozilla’s domains. This means
no mouseless navigation on these pages.</p>

<p>The good news is that <strong>Tridactyl has better mouseless browsing than
Vimperator</strong>. Its “tag” overlay is alphabetic rather than numeric, so
it’s easier to type. When it’s available, the experience is better.</p>

<ul>
  <li>Custom key bindings for <em>everything</em>.</li>
</ul>

<p>In normal mode, which is the usual state Vimperator/Tridactyl is in,
I’ve got useful functionality bound to single keys. There’s little
straining for the CTRL key. I use <code class="highlighter-rouge">d</code> to close a tab, <code class="highlighter-rouge">u</code> to undo it.
In my own configuration I use <code class="highlighter-rouge">w</code> and <code class="highlighter-rouge">e</code> to change tabs, and <code class="highlighter-rouge">x</code> and
<code class="highlighter-rouge">c</code> to move through the history. I can navigate to any “quickmark” in
three keystrokes. It’s all very fast and fluid.</p>

<p>Since WebExtensions are sandboxed, extensions have limited ability to
capture these keystrokes. If the wrong browser UI element is focused,
they don’t work. If the current page is one of those
extension-restricted pages, these keys don’t work.</p>

<p>The worse problem of all, by <em>far</em>, is that <strong>WebExtensions are not
active until the current page has loaded</strong> (or something like that).
This is the most glaring flaw in WebExtensions, and I’m surprised it
still hasn’t been addressed. It negatively affects every extension I
use. What this means for Tridactyl is that for a second or so after
navigating a link, I can’t interact with the extension, and the
keystrokes are lost. It’s incredibly frustrating, both having to wait
on a slow remote server to get control back, and to forget about this
issue and have a bunch of keystrokes eaten.</p>

<h3 id="other-extensions">Other extensions</h3>

<p>I’m continuing to use <a href="https://github.com/gorhill/uBlock"><strong>uBlock Origin</strong></a>. Nothing changes. As
I’ve said before, an ad-blocker is by far the most important security
tool on your computer. If you practice good computer hygiene,
malicious third-party ads/scripts are the biggest threat vector for
your system. A website telling you to turn off your ad-blocker should
be regarded as suspiciously as being told to turn off your virus
scanner (for all you Windows users who are still using one).</p>

<p>The opposite of mouseless browsing is keyboardless browsing. When I’m
<em>not</em> being productive, I’m often not touching the keyboard, and
navigating with just the mouse is most comfortable. However, clicking
little buttons is not. So instead of clicking the backward and forward
buttons, I prefer to swipe the mouse, e.g. make a gesture.</p>

<p>I previously used FireGestures, an XUL extension. I’m now using
<a href="https://github.com/Robbendebiene/Gesturefy"><strong>Gesturefy</strong></a>. I also considered Foxy Gestures, but it
doesn’t currently support ESR releases. Unfortunately all mouse
gesture WebExtensions suffer from the page load problem: any gesture
given before the page loads is lost. It’s less of any annoyance than
with Tridactyl, but it still trips me up. They also don’t work on
extension-restricted pages.</p>

<p>Firefox 60 ESR is the first time I’m using a browser supported by
<a href="https://github.com/gorhill/uMatrix"><strong>uMatrix</strong></a> — another blessing from the author of uBlock
Origin (Raymond Hill) — so I’ve been trying it out. Effective use
requires some in-depth knowledge of how the web works, such as the
same-origin policy, etc. It’s not something I’d recommend for most
people.</p>

<p><a href="https://github.com/greasemonkey/greasemonkey"><strong>GreaseMonkey</strong></a> was converted to the WebExtensions API awhile
back. As a result it’s a bit less capable than it used to be, and I had
to adjust a couple of <a href="https://greasyfork.org/en/users/2022-skeeto">my own scripts</a> before they’d work again. I
use it as a “light extension” system.</p>

<h3 id="xul-alternatives">XUL alternatives</h3>

<p>Many people have suggested using one of the several Firefox forks that’s
maintaining XUL compatibility. I haven’t taken this seriously for a
couple of reasons:</p>

<ul>
  <li>Maintaining a feature-complete web browser like Firefox is a <em>very</em>
serious undertaking, and I trust few organizations to do it
correctly.</li>
</ul>

<p>Even the Debian community gave up on that idea long ago, and they’ve
made a special exception that allows recent versions of Firefox and
Chrome into the stable release. Web browsers are huge and complex
because web standards are huge and complex (a situation that concerns
me in the long term). The <a href="https://www.cvedetails.com/product/3264/Mozilla-Firefox.html?vendor_id=452">vulnerabilities that pop up regularly are
frightening</a>.</p>

<p>In <em>Back to the Future Part II</em>, Biff Tannen was thinking too small.
Instead of a sports almanac, he should have brought a copy of the CVE
database.</p>

<p>This is why I also can’t just keep using an old version of Firefox. If I
was unhappy with, say, the direction of Emacs 26, I could keep using
Emacs 25 essentially forever, frozen in time. However, Firefox is
<em>internet software</em>. <a href="https://utcc.utoronto.ca/~cks/space/blog/tech/InternetSoftwareDecay">Internet software decays and must be
maintained</a>.</p>

<ul>
  <li>The community has already abandoned XUL extensions.</li>
</ul>

<p>Most importantly, the Vimperator extension is no longer maintained.
There’s no reason to stick around this ghost town.</p>

<h3 id="special-tridactyl-customizations">Special Tridactyl customizations</h3>

<p>The syntax for <code class="highlighter-rouge">.tridactylrc</code> is a bit different than <code class="highlighter-rouge">.vimperatorrc</code>,
so I couldn’t just reuse my old configuration file. Key bindings are
simple enough to translate, and quickmarks are configured almost the
same way. However, it took me some time to figure out the rest.</p>

<p>With Vimperator I’d been using Firefox’s obscure “bookmark keywords”
feature, where a bookmark is associated with a single word. In
Vimperator I’d use this as a prefix when opening a new tab to change the
context of the location I was requesting.</p>

<p>For example, to visit the Firefox subreddit I’d press <code class="highlighter-rouge">o</code> to start
opening a new tab, then <code class="highlighter-rouge">r firefox</code>. I had <code class="highlighter-rouge">r</code> registered via
<code class="highlighter-rouge">.vimperatorrc</code> as the bookmark keyword for the URL template
<code class="highlighter-rouge">https://old.reddit.com/r/%s</code>.</p>

<p>WebExtensions doesn’t expose bookmark keywords, and keywords are likely
to be removed in a future Firefox release. So instead someone showed me
this trick:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set searchurls.r   https://old.reddit.com/r/%s
set searchurls.w   https://en.wikipedia.org/w/index.php?search=%s
set searchurls.wd  https://en.wiktionary.org/wiki/?search=%s
</code></pre></div></div>

<p>These lines in <code class="highlighter-rouge">.tridactylrc</code> recreates the old functionality. Works
like a charm!</p>

<p>Another initial annoyance is that WebExtensions only exposes the X
clipboard (<code class="highlighter-rouge">XA_CLIPBOARD</code>), not the X selection (<code class="highlighter-rouge">XA_PRIMARY</code>).
However, I nearly always use the X selection for copy-paste, so it was
like I didn’t have any clipboard access. (Honestly, I’d prefer
<code class="highlighter-rouge">XA_CLIPBOARD</code> didn’t exist at all.) Again, native messaging routes
around the problem nicely, and it’s trivial to configure:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set yankto both
set putfrom selection
</code></pre></div></div>

<p>There’s an experimental feature, <code class="highlighter-rouge">guiset</code> to remove most of Firefox’s
UI elements, so that it even looks nearly like the old Vimperator. As
of this writing, this feature works poorly, so I’m not using it. It’s
really not important to me anyway.</p>

<h3 id="todays-status">Today’s status</h3>

<p>So I’m back to about 85% of the functionality I had before the
calamity, which is far better than I had imagined. Other than the
frequent minor annoyances, I’m pretty satisfied.</p>

<p>In exchange I get better mouseless browsing and much, <em>much</em> better
performance. I’m not kidding, <strong>the difference Firefox Quantum makes
is night and day</strong>. In my own case, Firefox 60 ESR is using <em>one
third</em> of the memory of Firefox 52 ESR, and I’m not experiencing the
gradual memory leak. This really makes a difference on my laptop with
4GB of RAM.</p>

<p>So was it worth giving up that 15% capability for these improvements?
Perhaps it was. Now that I’ve finally made the leap, I’m feeling a lot
better about the whole situation.</p>


    